branches:
  except:
    - /travis.*/
version: '{build}'
skip_tags: true
clone_depth: 8
environment:
  APPVEYOR_SAVE_CACHE_ON_ERROR: true
  CYGWIN_MIRROR: http://cygwin.mirror.constant.com
  CACHE: C:\cache
  matrix:
  - BUILD: i686-pc-cygwin
    CYGWIN_ROOT: C:\cygwin
    SETUP: setup-x86.exe
  - BUILD: x86_64-pc-cygwin
    CYGWIN_ROOT: C:\cygwin64
    SETUP: setup-x86_64.exe
install:
- echo Updating Cygwin and installing build prerequisites
- "%CYGWIN_ROOT%\\%SETUP% -qnNdO -R %CYGWIN_ROOT% -s %CYGWIN_MIRROR% -l %CACHE% -g -P \
binutils,\
bison,\
ccache,\
flex,\
gcc-core,\
meson,\
ninja,\
pkg-config,\
python3,\
xz,\
windowsdriproto,\
xorgproto,\
libdmx-devel,\
libepoxy-devel,\
libfontenc-devel,\
libfreetype-devel,\
libGL-devel,\
libnettle-devel,\
libpixman1-devel,\
libtirpc-devel,\
libX11-devel,\
libXRes-devel,\
libXau-devel,\
libXaw-devel,\
libXdmcp-devel,\
libXext-devel,\
libXfont2-devel,\
libXi-devel,\
libXinerama-devel,\
libXmu-devel,\
libXpm-devel,\
libXrender-devel,\
libXtst-devel,\
libxcb-composite-devel,\
libxcb-ewmh-devel,\
libxcb-icccm-devel,\
libxcb-image-devel,\
libxcb-keysyms-devel,\
libxcb-randr-devel,\
libxcb-render-devel,\
libxcb-render-util-devel,\
libxcb-shape-devel,\
libxcb-util-devel,\
libxcb-xkb-devel,\
libxkbfile-devel,\
font-util,\
khronos-opengl-registry,\
python3-lxml,\
xkbcomp-devel,\
xkeyboard-config,\
xtrans,\
python36-mako,\
python36-six"
- echo Install done
- "%CYGWIN_ROOT%\\%SETUP% -qnNdO -R %CYGWIN_ROOT% -s %CYGWIN_MIRROR% -l %CACHE% -g"
cache:
- C:\cache
- '%CYGWIN_ROOT%\home\%USERNAME%\.ccache'
build_script:
- SET ORIG_PATH=%PATH%
- SET PATH=%CYGWIN_ROOT%/bin
- '%CYGWIN_ROOT%/bin/bash -lc "cd $APPVEYOR_BUILD_FOLDER; ./test/scripts/build-appveyor.sh"'
- '%CYGWIN_ROOT%/bin/bash -lc "cd $APPVEYOR_BUILD_FOLDER; ccache -s"'
deploy: off
test: off
# publish log artifacts on success or failure
on_finish:
- tar --ignore-failed-read -Jcf meson-log.tar.xz build/meson-logs
- tar --ignore-failed-read -Jcf xvfb-piglit.tar.xz build/test/piglit-results/xvfb
- SET PATH=%ORIG_PATH%
- appveyor PushArtifact meson-log.tar.xz
- appveyor PushArtifact xvfb-piglit.tar.xz
